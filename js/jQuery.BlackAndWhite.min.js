/**
 *
 * Version: 0.2.6
 * Author:  Gianluca Guarini
 * Contact: gianluca.guarini@gmail.com
 * Website: http://www.gianlucaguarini.com/
 * Twitter: @gianlucaguarini
 *
 * Copyright (c) 2013 Gianluca Guarini
 */
(function(e){e.fn.extend({BlackAndWhite:function(d){var j=this;d=e.extend({hoverEffect:!0,webworkerPath:!1,responsive:!0,invertHoverEffect:!1,speed:500,onImageReady:null},d);var y=d.hoverEffect,s=d.webworkerPath,q=d.invertHoverEffect,z=d.responsive,t=e.isPlainObject(d.speed)?d.speed.fadeIn:d.speed;e.isPlainObject(d.speed);var A=document.all&&!window.opera&&window.XMLHttpRequest?!0:!1,m={},u=function(c){if(m[c]||""===m[c])return m[c]+c;var e=document.createElement("div"),b=" Moz Webkit O ms Khtml".split(" "),
a;for(a in b)if("undefined"!==typeof e.style[b[a]+c])return m[c]=b[a],b[a]+c;return c.toLowerCase()},v,n=document.createElement("div");n.style.cssText=" -webkit- -moz- -o- -ms- ".split(" ").join("filter:blur(2px); ");v=!!n.style.length&&(void 0===document.documentMode||9<document.documentMode);var B=!!document.createElement("canvas").getContext,C=e(window),n="undefined"!==typeof Worker?!0:!1;u("Filter");var l=[],p=n&&s?new Worker(s+"BnWWorker.js"):!1,D=function(c){e(c.currentTarget).find(".BWfade").stop(!0,
!0)[!q?"fadeIn":"fadeOut"](t)},E=function(c){e(c.currentTarget).find(".BWfade").stop(!0,!0)[q?"fadeIn":"fadeOut"](t)},r=function(c){if("function"===typeof d.onImageReady)d.onImageReady(c)},w=function(){l.length&&(p.postMessage(l[0].imageData),p.onmessage=function(c){l[0].ctx.putImageData(c.data,0,0);r(l[0].img);l.splice(0,1);w()})},x=function(c,d){var b=c[0],a=b.src,g=c.width(),f=c.height(),h={position:"absolute",top:0,left:0,display:q?"none":"block",width:g,height:f};if(B&&!v){g=b.width;f=b.height;
e('<canvas class="BWfade" width="'+g+'" height="'+f+'"></canvas>').prependTo(d);a=d.find("canvas");a.css(h);h=a[0].getContext("2d");a=0;h.drawImage(b,0,0,g,f);var f=h.getImageData(0,0,g,f),k=f.data,j=k.length;if(p)l.push({imageData:f,ctx:h,img:b});else{for(;a<j;a+=4)g=0.3*k[a]+0.59*k[a+1]+0.11*k[a+2],k[a]=k[a+1]=k[a+2]=g;h.putImageData(f,0,0);r(b)}}else h[u("Filter")]="grayscale(100%)",e("<img src="+a+' width="'+g+'" height="'+f+'" class="BWFilter BWfade" /> ').prependTo(d),e(".BWFilter").css(e.extend(h,
{filter:"progid:DXImageTransform.Microsoft.BasicImage(grayscale=1)"})),r(b)};this.init=function(){j.each(function(c,d){var b=e(d),a=b.find("img");if(a.width())x(a,b);else a.on("load",function(){x(a,b)})});p&&w();y&&(j.on("mouseleave",D),j.on("mouseenter",E));if(z)C.on("resize orientationchange",j.resizeImages)};this.resizeImages=function(){j.each(function(c,d){var b=e(d).find("img:not(.BWFilter)"),a;A?(a=e(b).prop("width"),b=e(b).prop("height")):(a=e(b).width(),b=e(b).height());e(this).find(".BWFilter, canvas").css({width:a,
height:b})})};return this.init(d)}})})(jQuery);